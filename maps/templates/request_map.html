{% extends "base.html" %}

{% block title %}{{ block.super }} -- Map Generation{% endblock %}

{% block js %}
{{ block.super }}
{% load static %}
    <style>
        .ui-autocomplete-loading {
        background: white url('http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.2/themes/smoothness/images/ui-anim_basic_16x16.gif') right center no-repeat;
        }
        .search {
            position:relative; top:2px; /* readujst in jsfiddle */
            width: 400px;
            padding:8px 5px 8px 30px;
            border:1px solid #ccc;
            background:white url("http://i.imgur.com/lFkqn.png") left center no-repeat;
        }
    </style>
    <script type="text/javascript">
        $(document).ready(function() {
                // set defaults for dropdown boxes
                $('.spinner').spinner();
                $('#ranking_algorithm').val('1');
                $('#similarity_algorithm').val('2');
                $('#filtering_algorithm').val('1');
                $('#basemap_author').autocomplete({
                    source: '{% url top_authors %}',
                    minLength: 3,
                    });
                $('#basemap_conference').autocomplete({
                    source: '{% url top_conferences %}',
                    minLength: 3,
                    });
                $('#basemap_journal').autocomplete({
                    source: '{% url top_journals %}',
                    minLength: 3,
                    });
                $('#heatmap_author').autocomplete({
                    source: '{% url top_authors %}',
                    minLength: 3,
                    });
                $('#heatmap_conference').autocomplete({
                    source: '{% url top_conferences %}',
                    minLength: 3,
                    });
                $('#heatmap_journal').autocomplete({
                    source: '{% url top_journals %}',
                    minLength: 3,
                    });
                $('#maps').accordion({
                    collapsible:true
                    });
                $('#submit').button();
                $('#basemap_year_range').slider({
                    range:true,
                    min:1950,
                    max:2013,
                    values:[1950,2013],
                    slide:function(event, ui) {
                    $('#basemap_starting_year').val(ui.values[0]);
                    $('#basemap_ending_year').val(ui.values[1]);
                    }});
                $('#heatmap_year_range').slider({
                    range:true,
                    min:1950,
                    max:2013,
                    values:[1950,2013],
                    slide:function(event, ui) {
                    $('#heatmap_starting_year').val(ui.values[0]);
                    $('#heatmap_ending_year').val(ui.values[1]);
                    } });
                /*
                $('#basemap_starting_year').tooltip({
                    bodyHandler: function() { 
                        return $(this).attr('title'); 
                        }
                    });
                    */
            /*
			if ($(this).attr("id") == "ending_year" || ($(this).attr("for") == "ending_year")){
				$("#infobox").html("<b>Ending Year:</b><br>Only include documents published in this year or earlier.");
			}
			if ($(this).attr("id") == "sample_size" || ($(this).attr("for") == "sample_size")){
				$("#infobox").html("<b>Number of Documents:</b><br>Number of documents to include in random sample.");
			}
			if ($(this).attr("id") == "number_of_terms" || ($(this).attr("for") == "number_of_terms")){
				$("#infobox").html("<b>Number of Terms:</b><br> Control number of top terms (after ranking) to pass to similarity algorithm.");
			}
			if ($(this).attr("id") == "ranking" || ($(this).attr("for") == "ranking")){
				if ($("#TFICF").attr("selected") == "selected"){
					$("#infobox").html("<b>Ranking Algorithm:</b><br>TF/ICF:<br>(Term Frequency/Inverse Corpus Frequency) Rank terms by the number of occurrences in the document titles, divided by 1 + the number of occurrences in the Brown corpus");
				}

				if ($("#CV").attr("selected") == "selected"){
					$("#infobox").html("<b>Ranking Algorithm:</b><br>C-Value:<br> Rank by frequency, prioritizing nested terms (see <a href='http://link.springer.com/article/10.1007%2Fs007999900023'>Frantzi et. al</a> for details). Excludes unigrams (single-word terms)");
				}
				if ($("#CVU").attr("selected") == "selected"){
					$("#infobox").html("<b>Ranking Algorithm:</b><br>C-Value With Unigrams:<br> Rank by frequency, prioritizing nested terms (see <a href='http://link.springer.com/article/10.1007%2Fs007999900023'>Frantzi et. al</a> for details). Includes unigrams (single-word terms)");
				}
				if ($("#TF").attr("selected") == "selected"){
					$("#infobox").html("<b>Ranking Algorithm:</b><br>TF/ICF:<br>(Term Frequency) Rank terms by the number of occurrences in the document titles");
				}
			}

			if ($(this).attr("id") == "similarity" || ($(this).attr("for") == "similarity")){
				if ($("#LSA").attr("selected") == "selected"){
					$("#infobox").html("<b>Similarity Algorithm:</b><br>Latent Semantic Analysis:<br>Produce set of concepts underlying phrases in titles using singular value decomposition, then use <a href='http://en.wikipedia.org/wiki/Cosine_similarity'>cosine similarity</a> between term rows as pairwise term similarity.");
				}
				if ($("#Jaccard").attr("selected") == "selected"){
					$("#infobox").html("<b>Similarity Algorithm:</b><br>Jaccard:<br>Calculate pairwise term similarity as number of documents two terms appeared together in, divided by number of documents either term appeared in. Treats terms as atomic units: e.g. ``Jaccard'' and ``Jaccard Partial Match'' are not the same term. Read more about Jaccard and Jaccard Partial Match <a href='http://en.wikipedia.org/wiki/Jaccard_index'>here.</a>");
				}
				if ($("#Jaccard_PM").attr("selected") == "selected"){
					$("#infobox").html("<b>Similarity Algorithm:</b><br>Jaccard Partial Match:<br>Calculate pairwise term similarity as number of documents two terms appeared together in, divided by number of documents either term appeared in. Treats two terms as the same if they overlap: e.g. ``Jaccard'' and ``Jaccard Partial Match'' are counted as the same term. Read more about Jaccard and Jaccard Partial Match <a href='http://en.wikipedia.org/wiki/Jaccard_index'>here.</a>");
				}
				if ($("#DJS").attr("selected") == "selected"){
					$("#infobox").html("<b>Similarity Algorithm:</b><br>Distributional (Jensen-Shannon):<br>Compute pairwise term similarity as the <a href='http://en.wikipedia.org/wiki/Jensen%E2%80%93Shannon_divergence'>Jensen-Shannon divergence</a> of their multinomial term context distributions across all documents. Very slow.");
				}
			}
			if ($(this).attr("id") == "filtering" || ($(this).attr("for") == "filtering")){
				if ($("#top_terms").attr("selected") == "selected"){
					$("#infobox").html("<b>Filtering Algorithm:</b><br>Top Terms Only:<br>Plot the 500 highest-ranked terms, and the similarities between these terms. Do not bring in any lesser-ranked terms, even if they are very similar to top terms.");
				}
				if ($("#lesser_terms").attr("selected") == "selected"){
					$("#infobox").html("<b>Filtering Algorithm:</b><br>Pull Lesser Terms:<br>Plot the 75 highest-ranked terms, and the 9 most-similar terms to each of these top terms. Can pull in terms beyond the top 75, if they are more similar than any of the other top terms.");
				}
				if ($("#hybrid").attr("selected") == "selected"){
					$("#infobox").html("<b>Filtering Algorithm:</b><br>Hybrid:<br>Acts as both Top Terms Only and Pull Lesser Terms.");
				}
			}
		}
        */
        /*
		$("input").mouseover(bringInTooltip);
		$("label").mouseover(bringInTooltip);
		$("select").mouseover(bringInTooltip);
        */
        });
    </script>
{% endblock %}

{% block content %}
<form method="post" action='{% url request_map %} '>
    {% csrf_token %}
    <div id='maps'>
        <h3>Basemap</h3>
        <div id='basemap_inner'>
            <label for='basemap_starting_year'>Starting Year:</label>
            <input id='basemap_starting_year' title='<b>Starting Year:</b><br>Only include documents published in this year or later.' class='spinner' name='basemap_starting_year' min='1950' max='2013' value='1950' autocomplete='off'>
            <label for='basemap_ending_year'>Ending Year:</label>
            <input id='basemap_ending_year' class='spinner' name='basemap_ending_year' min='1950' max='2013' value='2013' autocomplete='off'>
            <div id="basemap_year_range"></div>

            <label for='basemap_sample_size'>Number of Documents:</label><br>
            <input id='basemap_sample_size'  class='spinner' name='basemap_sample_size' min='100' max='50000' value='30000' autocomplete='off'><br>
            <label for='number_of_terms'>Number of Terms:</label><br>
            <input id='number_of_terms'  class='spinner' name='number_of_terms' min='100' max='5000' value='1000' autocomplete='off'><br>
            <label for='ranking_algorithm'>Ranking Algorithm:</label><br>
            <select name="ranking_algorithm" id="ranking_algorithm">
                <option value="0">TF/ICF</option>
                <option value="1">C-Value</option>
                <option value="2">C-Value + Unigrams</option>
                <option value="3">TF</option>
            </select><br>
            <label for='similarity_algorithm'>Similarity Algorithm:</label><br>
            <select name="similarity_algorithm" id="similarity_algorithm">
                <option value="0">Latent Semantic Analysis</option>
                <option value="1">Jaccard</option>
                <option value="2">Jaccard Partial Match</option>
                <option value="3">Distributional (Jensen-Shannon)</option>
            </select><br>
            <label for='filtering_algorithm'>Filtering Algorithm:</label><br>
            <select name="filtering_algorithm" id="filtering_algorithm">
                <option value="0">Top Terms Only</option>
                <option value="1">Pull Lesser Terms</option>
                <option value="2">Hybrid</option>
            </select><br>
            <label for='basemap_term_type'>Term Type:</label><br>
            <select name="basemap_term_type" id="basemap_term_type">
                <option value="0">Phrases</option>
                <option value="1">All Words</option>
                <option value="2">Words From Phrases</option>
            </select><br>
            <label for='basemap_author' >Author:</label><br>
            <input type='text' id='basemap_author' name='basemap_author' class="search"><br>
            <label for='basemap_conference'>Conference:</label><br>
            <input type='text' id='basemap_conference' name='basemap_conference' class="search"><br>
            <label for='basemap_journal'>Journal:</label><br>
            <input type='text' id='basemap_journal' name='basemap_journal' class="search"><br>
        </div>
        <h3>Heatmap</h3>
        <div id='heatmap_inner'>
            <label for='heatmap_starting_year'>Starting Year:</label>
            <input id='heatmap_starting_year' class='spinner' name='heatmap_starting_year' min='1950' max='2013' value='1950' autocomplete='off'>
            <label for='heatmap_ending_year'>Ending Year:</label>
            <input id='heatmap_ending_year' class='spinner' name='heatmap_ending_year' min='1950' max='2013' value='2013' autocomplete='off'>
            <div id="heatmap_year_range"></div>
            <label for='heatmap_sample_size'>Number of Documents:</label><br>
            <input id='heatmap_sample_size' class='spinner' class='spinner' name='heatmap_sample_size' min='100' max='50000' value='2000' autocomplete='off'><br>
            <label for='heatmap_term_type'>Term Type:</label><br>
            <select name="heatmap_term_type" id="heatmap_term_type">
                <option value="0">Phrases</option>
                <option value="1">All Words</option>
                <option value="2">Words From Phrases</option>
            </select><br>
            <label for='heatmap_author'>Author:</label><br>
            <input type='text' id='heatmap_author' name='heatmap_author' class="search"><br>
            <label for='heatmap_conference'>Conference:</label><br>
            <input type='text' id='heatmap_conference' name='heatmap_conference' class="search"><br>
            <label for='heatmap_journal'>Journal:</label><br>
            <input type='text' id='heatmap_journal' name='heatmap_journal' class="search"><br>
        </div>
    </div>

        <input id='submit' value='Create Map' type='submit'>
    </form>
{% endblock %}
